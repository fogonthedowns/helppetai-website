# Infrastructure Changes - September 9, 2025

## Lambda Dependency Fix

**Issue**: `helppet-transcript-processor` failing with `ImportModuleError: No module named 'pydantic_core._pydantic_core'`

**Root Cause**: Platform mismatch - dependencies installed on macOS ARM64 but Lambda runs Linux x86_64

**Changes Made**:

1. **Updated requirements.txt**:
   - Added `pydantic>=2.0.0`
   - Added `pydantic-core>=2.0.0`

2. **Modified transcription_stack.yaml**:
   - Removed Klayers dependency from `TranscriptProcessorFunction`
   - Let deployment script handle all dependencies

3. **Enhanced deploy.sh**:
   - Added Docker-based dependency building using `public.ecr.aws/lambda/python:3.9`
   - **CRITICAL**: Added `--platform linux/amd64` to force x86_64 architecture
   - Ensures Linux x86_64 wheels instead of ARM64 (pydantic-core-2.39.0-cp39-cp39-manylinux_2_17_x86_64)
   - Proper platform targeting for compiled extensions

**Result**: Lambda function now imports all modules successfully, resolving transcript processing failures

**Deployed**: CloudFormation stack `helppet-transcription-service` updated via `./deploy.sh`