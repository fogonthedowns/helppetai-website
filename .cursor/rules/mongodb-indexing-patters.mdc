---
description:
globs:
alwaysApply: false
---

# MongoDB Indexing Strategies

## Essential Indexes
```python
class Patient(Document):
    # Compound indexes for common queries
    class Settings:
        indexes = [
            [("medical_record_number", 1), ("is_deleted", 1)],
            [("created_at", -1)],  # Recent patients first
            [("last_name", 1), ("first_name", 1)],
            [("date_of_birth", 1)],
            [("phone", 1)],  # Sparse index
            [("email", 1)],  # Sparse index
            [("provider_id", 1), ("created_at", -1)]
        ]
```

## Performance Rules
- Always include `is_deleted` in compound indexes
- Use sparse indexes for optional fields (phone, email)
- Create text indexes for search functionality
- Index foreign keys (provider_id, facility_id)

## Query Optimization
- Use `.hint()` for complex queries
- Monitor slow queries with profiling
- Use aggregation pipeline for complex filtering
- Implement pagination with skip/limit efficiently