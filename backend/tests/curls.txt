TOKEN=$(curl -sS -X POST "http://localhost:8000/api/v1/auth/token" -H "Content-Type: application/x-www-form-urlencoded" -d "username=jwade&password=rep8iv" 2>/dev/null | jq -r '.access_token')
PRACTICE_ID=$(curl -sS -X POST "http://localhost:8000/api/v1/practices/" -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" -d '{"name":"Test Practice","phone":"555-0000","email":"test@practice.com","address":"123 Main St","license_number":"LIC-TEST-001","specialties":["general"],"accepts_new_patients":true}' | jq -r '.uuid')
VET1_ID=$(curl -sS -X POST "http://localhost:8000/api/v1/auth/signup" -H "Content-Type: application/json" -d '{"username":"vet1","password":"password1","email":"vet1@test.com","full_name":"Vet One","role":"VET"}' | jq -r '.id')
VET2_ID=$(curl -sS -X POST "http://localhost:8000/api/v1/auth/signup" -H "Content-Type: application/json" -d '{"username":"vet2","password":"password2","email":"vet2@test.com","full_name":"Vet Two","role":"VET"}' | jq -r '.id')
curl -sS -X PUT "http://localhost:8000/api/v1/auth/me/practice" -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" -d "{\"practice_id\":\"$PRACTICE_ID\"}"
VET1_TOKEN=$(curl -sS -X POST "http://localhost:8000/api/v1/auth/token" -H "Content-Type: application/x-www-form-urlencoded" -d "username=vet1&password=password1" | jq -r '.access_token')
VET2_TOKEN=$(curl -sS -X POST "http://localhost:8000/api/v1/auth/token" -H "Content-Type: application/x-www-form-urlencoded" -d "username=vet2&password=password2" | jq -r '.access_token')
curl -sS -X PUT "http://localhost:8000/api/v1/auth/me/practice" -H "Authorization: Bearer $VET1_TOKEN" -H "Content-Type: application/json" -d "{\"practice_id\":\"$PRACTICE_ID\"}"
curl -sS -X PUT "http://localhost:8000/api/v1/auth/me/practice" -H "Authorization: Bearer $VET2_TOKEN" -H "Content-Type: application/json" -d "{\"practice_id\":\"$PRACTICE_ID\"}"
PET_OWNER_ID=$(curl -sS -X POST "http://localhost:8000/api/v1/pet_owners/" -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" -d '{"full_name":"Pet Owner","email":"owner@test.com","phone":"555-1234","address":"456 Oak St"}' | jq -r '.uuid')
PET_ID=$(curl -sS -X POST "http://localhost:8000/api/v1/pets" -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" -d "{\"owner_id\":\"$PET_OWNER_ID\",\"name\":\"Fido\",\"species\":\"dog\",\"breed\":\"mutt\",\"gender\":\"male\"}" | jq -r '.uuid')
NOW_UTC=$(date -u +"%Y-%m-%dT%H:00:00Z")
TOMORROW_UTC=$(date -u -v+1d +"%Y-%m-%dT%H:00:00Z")
curl -sS -X POST "http://localhost:8000/api/v1/scheduling-unix/vet-availability" -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" -d "{\"vet_user_id\":\"$VET1_ID\",\"practice_id\":\"$PRACTICE_ID\",\"start_at\":\"$NOW_UTC\",\"end_at\":\"$(date -u -v+2H +\"%Y-%m-%dT%H:00:00Z\")\"}"
curl -sS -X POST "http://localhost:8000/api/v1/scheduling-unix/vet-availability" -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" -d "{\"vet_user_id\":\"$VET2_ID\",\"practice_id\":\"$PRACTICE_ID\",\"start_at\":\"$TOMORROW_UTC\",\"end_at\":\"$(date -u -v+1d -v+3H +\"%Y-%m-%dT%H:00:00Z\")\"}"
curl -sS -X POST "http://localhost:8000/webhook/phone" -H "Content-Type: application/json" -d "{\"name\":\"get_first_available_flexible\",\"args\":{\"time_preference\":\"morning\",\"practice_id\":\"$PRACTICE_ID\",\"timezone\":\"America/Los_Angeles\",\"weeks_from_now\":1}}"
